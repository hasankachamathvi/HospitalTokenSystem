<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hospital Queue Admin Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Simple popup style */
        #addPatientPopup {
            display: none;
            position: fixed;
            top:0; left:0;
            width:100%; height:100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        #addPatientPopup .popup-content {
            background: #fff;
            padding: 2rem;
            border-radius: 10px;
            max-width: 400px;
            margin:auto;
            position: relative;
        }
        #addPatientPopup input {
            width: 100%;
            margin: 0.5rem 0;
            padding: 0.5rem;
        }
        #addPatientPopup button {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            background: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #addPatientPopup .close {
            position: absolute;
            top:10px;
            right:15px;
            font-size:20px;
            cursor:pointer;
        }
        table th, table td {
            padding: 0.5rem;
            border:1px solid #ddd;
        }
        table th {
            background: #007BFF;
            color:white;
        }
        button.serveBtn {
            padding: 0.3rem 0.5rem;
            background: green;
            color:white;
            border:none;
            border-radius:3px;
            cursor:pointer;
        }
    </style>
</head>
<body>

<div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Hospital Admin</h2>
        </div>
        <ul class="nav">
            <li onclick="showSection('overview')">Overview</li>
            <li onclick="showSection('manage')">Manage Queue</li>
            <li onclick="showSection('live')">Live Queue</li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Overview Section -->
        <section id="overview" class="section">
            <h1>Dashboard Overview</h1>
            <div class="cards">
                <div class="card">
                    <h3>Total Patients</h3>
                    <p id="totalPatients">0</p>
                </div>
                <div class="card">
                    <h3>Waiting</h3>
                    <p id="waitingPatients">0</p>
                </div>
                <div class="card">
                    <h3>Served</h3>
                    <p id="servedPatients">0</p>
                </div>
            </div>
            <div style="text-align:center; margin-top:1rem;">
                <button onclick="openAddPatient()">Add Patient</button>
            </div>
        </section>

        <!-- Manage Queue Section -->
        <section id="manage" class="section" style="display:none;">
            <h1>Manage Queue</h1>
            <table>
                <thead>
                <tr>
                    <th>Token</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Date</th>
                    <th>Action</th>
                </tr>
                </thead>
                <tbody id="adminQueueTable"></tbody>
            </table>
        </section>

        <!-- Live Queue Section -->
        <section id="live" class="section" style="display:none;">
            <h1>Live Queue</h1>
            <table>
                <thead>
                <tr>
                    <th>Token</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Date</th>
                </tr>
                </thead>
                <tbody id="adminLiveQueueTable"></tbody>
            </table>
        </section>
    </main>
</div>

<!-- Add Patient Popup -->
<div id="addPatientPopup">
    <div class="popup-content">
        <span class="close" onclick="closeAddPatient()">&times;</span>
        <h2>Add Patient</h2>
        <input type="text" id="adminPatientName" placeholder="Full Name">
        <input type="email" id="adminPatientEmail" placeholder="Email">
        <input type="tel" id="adminPatientPhone" placeholder="Phone">
        <input type="datetime-local" id="adminPatientDate">
        <button onclick="addPatientFromAdmin()">Add</button>
    </div>
</div>

<script src="linkedlist.js"></script>
<script>
    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.style.display='none');
        document.getElementById(id).style.display = 'block';
    }

    // Popup controls
    function openAddPatient() {
        document.getElementById("addPatientPopup").style.display = "flex";
    }
    function closeAddPatient() {
        document.getElementById("addPatientPopup").style.display = "none";
    }

    // Add patient from admin dashboard
    function addPatientFromAdmin() {
        const patient = {
            name: document.getElementById("adminPatientName").value.trim(),
            email: document.getElementById("adminPatientEmail").value.trim(),
            phone: document.getElementById("adminPatientPhone").value.trim(),
            date: document.getElementById("adminPatientDate").value
        };
        if(!patient.name || !patient.email || !patient.phone || !patient.date){
            return alert("Please fill all fields");
        }

        queue.insertAtEnd(patient);

        document.getElementById("adminPatientName").value = "";
        document.getElementById("adminPatientEmail").value = "";
        document.getElementById("adminPatientPhone").value = "";
        document.getElementById("adminPatientDate").value = "";

        closeAddPatient();
        updateAdminTables();
    }

    // Display queue in Manage & Live tables
    function updateAdminTables() {
        const patients = queue.traverse();

        const manageTable = document.getElementById('adminQueueTable');
        const liveTable = document.getElementById('adminLiveQueueTable');

        manageTable.innerHTML = "";
        liveTable.innerHTML = "";

        patients.forEach((p, index) => {
            // Manage table
            const row = manageTable.insertRow();
            row.insertCell(0).innerText = index+1;
            row.insertCell(1).innerText = p.name;
            row.insertCell(2).innerText = p.email;
            row.insertCell(3).innerText = p.phone;
            row.insertCell(4).innerText = p.date;
            const actionCell = row.insertCell(5);
            const serveBtn = document.createElement('button');
            serveBtn.className = "serveBtn";
            serveBtn.innerText = "Serve";
            serveBtn.onclick = () => { queue.deleteFromPosition(index); updateAdminTables(); };
            actionCell.appendChild(serveBtn);

            // Live table
            const liveRow = liveTable.insertRow();
            liveRow.insertCell(0).innerText = index+1;
            liveRow.insertCell(1).innerText = p.name;
            liveRow.insertCell(2).innerText = p.email;
            liveRow.insertCell(3).innerText = p.phone;
            liveRow.insertCell(4).innerText = p.date;
        });

        // Update overview cards
        document.getElementById('totalPatients').innerText = patients.length;
        document.getElementById('waitingPatients').innerText = patients.length;
    }

    // Live update every 2 sec
    setInterval(updateAdminTables, 2000);
</script>

</body>
</html>
